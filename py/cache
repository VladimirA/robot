00000020: 20 70 6f 73 69 74 69 6f 6e 3c 2f 74 69 74 6c 65  <html>.  <head>.
00000020: 20 70 6f 73 69 74 69 6f 6e 3c 2f 74 69 74 6c 65      <title>Robot
00000020: 20 70 6f 73 69 74 69 6f 6e 3c 2f 74 69 74 6c 65   position</title
00000030: 3e 0a 3c 73 63 72 69 70 74 20 74 79 70 65 3d 22  >.<script type="
00000040: 74 65 78 74 2f 6a 61 76 61 73 63 72 69 70 74 22  text/javascript"
00000050: 20 73 72 63 3d 22 68 74 74 70 3a 2f 2f 63 6f 64   src="http://cod
00000060: 65 2e 6a 71 75 65 72 79 2e 63 6f 6d 2f 6a 71 75  e.jquery.com/jqu
00000070: 65 72 79 2d 32 2e 31 2e 30 2e 6d 69 6e 2e 6a 73  ery-2.1.0.min.js
00000080: 22 3e 3c 2f 73 63 72 69 70 74 3e 0a 3c 73 63 72  "></script>.<scr
00000090: 69 70 74 20 74 79 70 65 3d 22 74 65 78 74 2f 6a  ipt type="text/j
000000a0: 61 76 61 73 63 72 69 70 74 22 20 73 72 63 3d 22  avascript" src="
000000b0: 68 74 74 70 3a 2f 2f 6c 65 61 72 6e 69 6e 67 77  http://learningw
000000c0: 65 62 67 6c 2e 63 6f 6d 2f 6c 65 73 73 6f 6e 73  ebgl.com/lessons
000000d0: 2f 6c 65 73 73 6f 6e 30 31 2f 67 6c 4d 61 74 72  /lesson01/glMatr
000000e0: 69 78 2d 30 2e 39 2e 35 2e 6d 69 6e 2e 6a 73 22  ix-0.9.5.min.js"
000000f0: 3e 3c 2f 73 63 72 69 70 74 3e 0a 20 20 20 20 3c  ></script>.    <
00000100: 73 63 72 69 70 74 3e 0a 2f 2f 20 6c 6f 61 64 20  script>.// load 
00000110: 70 6f 73 69 74 69 6f 6e 0a 76 61 72 20 67 79 72  position.var gyr
00000120: 6f 3b 0a 76 61 72 20 61 63 63 65 6c 3b 0a 0a 66  o;.var accel;..f
00000130: 75 6e 63 74 69 6f 6e 20 72 65 66 72 65 73 68 44  unction refreshD
00000140: 61 74 61 28 29 20 7b 0a 24 2e 61 6a 61 78 28 7b  ata() {.$.ajax({
00000150: 0a 20 20 75 72 6c 3a 20 22 2f 70 6f 73 69 74 69  .  url: "/positi
00000160: 6f 6e 22 2c 0a 20 20 61 73 79 6e 63 3a 20 66 61  on",.  async: fa
00000170: 6c 73 65 2c 0a 20 20 63 6f 6e 74 65 78 74 3a 20  lse,.  context: 
00000180: 64 6f 63 75 6d 65 6e 74 2e 62 6f 64 79 0a 7d 29  document.body.})
00000190: 2e 64 6f 6e 65 28 66 75 6e 63 74 69 6f 6e 28 20  .done(function( 
000001a0: 64 61 74 61 20 29 20 7b 0a 20 20 20 20 67 79 72  data ) {.    gyr
000001b0: 6f 20 3d 20 64 61 74 61 2e 67 79 72 6f 3b 0a 20  o = data.gyro;. 
000001c0: 20 20 20 61 63 63 65 6c 20 3d 20 64 61 74 61 2e     accel = data.
000001d0: 61 63 63 3b 0a 20 20 7d 29 3b 0a 20 69 66 20 28  acc;.  });. if (
000001e0: 20 63 6f 6e 73 6f 6c 65 20 26 26 20 63 6f 6e 73   console && cons
000001f0: 6f 6c 65 2e 6c 6f 67 20 29 20 7b 0a 20 20 20 20  ole.log ) {.    
00000200: 20 20 63 6f 6e 73 6f 6c 65 2e 6c 6f 67 28 20 22    console.log( "
00000210: 47 79 72 6f 3a 20 22 2c 20 67 79 72 6f 20 29 3b  Gyro: ", gyro );
00000220: 0a 20 20 20 20 20 20 63 6f 6e 73 6f 6c 65 2e 6c  .      console.l
00000230: 6f 67 28 20 22 41 63 63 65 6c 3a 20 22 2c 20 61  og( "Accel: ", a
00000240: 63 63 65 6c 20 29 3b 0a 20 20 20 20 7d 0a 7d 0a  ccel );.    }.}.
00000250: 0a 0a 0a 0a 0a 0a 20 76 61 72 20 67 6c 3b 0a 20  ...... var gl;. 
00000260: 20 66 75 6e 63 74 69 6f 6e 20 69 6e 69 74 47 4c   function initGL
00000270: 28 63 61 6e 76 61 73 29 20 7b 0a 20 20 20 20 74  (canvas) {.    t
00000280: 72 79 20 7b 0a 20 20 20 20 20 20 67 6c 20 3d 20  ry {.      gl = 
00000290: 63 61 6e 76 61 73 2e 67 65 74 43 6f 6e 74 65 78  canvas.getContex
000002a0: 74 28 22 65 78 70 65 72 69 6d 65 6e 74 61 6c 2d  t("experimental-
000002b0: 77 65 62 67 6c 22 29 3b 0a 20 20 20 20 20 20 67  webgl");.      g
000002c0: 6c 2e 76 69 65 77 70 6f 72 74 57 69 64 74 68 20  l.viewportWidth 
000002d0: 3d 20 63 61 6e 76 61 73 2e 77 69 64 74 68 3b 0a  = canvas.width;.
000002e0: 20 20 20 20 20 20 67 6c 2e 76 69 65 77 70 6f 72        gl.viewpor
000002f0: 74 48 65 69 67 68 74 20 3d 20 63 61 6e 76 61 73  tHeight = canvas
00000300: 2e 68 65 69 67 68 74 3b 0a 20 20 20 20 7d 20 63  .height;.    } c
00000310: 61 74 63 68 28 65 29 20 7b 0a 20 20 20 20 7d 0a  atch(e) {.    }.
00000320: 20 20 20 20 69 66 20 28 21 67 6c 29 20 7b 0a 20      if (!gl) {. 
00000330: 20 20 20 20 20 61 6c 65 72 74 28 22 43 6f 75 6c       alert("Coul
00000340: 64 20 6e 6f 74 20 69 6e 69 74 69 61 6c 69 73 65  d not initialise
00000350: 20 57 65 62 47 4c 2c 20 73 6f 72 72 79 20 3a 2d   WebGL, sorry :-
00000360: 28 20 22 29 3b 0a 20 20 20 20 7d 0a 20 20 7d 0a  ( ");.    }.  }.
00000370: 0a 0a 20 20 76 61 72 20 6d 76 4d 61 74 72 69 78  ..  var mvMatrix
00000380: 20 3d 20 6d 61 74 34 2e 63 72 65 61 74 65 28 29   = mat4.create()
00000390: 3b 0a 20 20 76 61 72 20 70 4d 61 74 72 69 78 20  ;.  var pMatrix 
000003a0: 3d 20 6d 61 74 34 2e 63 72 65 61 74 65 28 29 3b  = mat4.create();
000003b0: 0a 0a 20 20 76 61 72 20 6d 76 4d 61 74 72 69 78  ..  var mvMatrix
000003c0: 53 74 61 63 6b 20 3d 20 5b 5d 3b 0a 0a 20 20 66  Stack = [];..  f
000003d0: 75 6e 63 74 69 6f 6e 20 6d 76 50 75 73 68 4d 61  unction mvPushMa
000003e0: 74 72 69 78 28 29 20 7b 0a 20 20 20 20 76 61 72  trix() {.    var
000003f0: 20 63 6f 70 79 20 3d 20 6d 61 74 34 2e 63 72 65   copy = mat4.cre
00000400: 61 74 65 28 29 3b 0a 20 20 20 20 6d 61 74 34 2e  ate();.    mat4.
00000410: 73 65 74 28 6d 76 4d 61 74 72 69 78 2c 20 63 6f  set(mvMatrix, co
00000420: 70 79 29 3b 0a 20 20 20 20 6d 76 4d 61 74 72 69  py);.    mvMatri
00000430: 78 53 74 61 63 6b 2e 70 75 73 68 28 63 6f 70 79  xStack.push(copy
00000440: 29 3b 0a 20 20 7d 0a 0a 20 20 66 75 6e 63 74 69  );.  }..  functi
00000450: 6f 6e 20 6d 76 50 6f 70 4d 61 74 72 69 78 28 29  on mvPopMatrix()
00000460: 20 7b 0a 20 20 20 20 69 66 20 28 6d 76 4d 61 74   {.    if (mvMat
00000470: 72 69 78 53 74 61 63 6b 2e 6c 65 6e 67 74 68 20  rixStack.length 
00000480: 3d 3d 20 30 29 20 7b 0a 20 20 20 20 20 20 74 68  == 0) {.      th
00000490: 72 6f 77 20 22 49 6e 76 61 6c 69 64 20 70 6f 70  row "Invalid pop
000004a0: 4d 61 74 72 69 78 21 22 3b 0a 20 20 20 20 7d 0a  Matrix!";.    }.
000004b0: 20 20 20 20 6d 76 4d 61 74 72 69 78 20 3d 20 6d      mvMatrix = m
000004c0: 76 4d 61 74 72 69 78 53 74 61 63 6b 2e 70 6f 70  vMatrixStack.pop
000004d0: 28 29 3b 0a 20 20 7d 0a 0a 0a 20 20 76 61 72 20  ();.  }...  var 
000004e0: 73 68 61 64 65 72 50 72 6f 67 72 61 6d 3b 0a 20  shaderProgram;. 
000004f0: 20 66 75 6e 63 74 69 6f 6e 20 69 6e 69 74 53 68   function initSh
00000500: 61 64 65 72 73 28 29 20 7b 0a 20 20 20 20 76 61  aders() {.    va
00000510: 72 20 66 72 61 67 6d 65 6e 74 53 68 61 64 65 72  r fragmentShader
00000520: 20 3d 20 67 65 74 53 68 61 64 65 72 28 67 6c 2c   = getShader(gl,
00000530: 20 22 73 68 61 64 65 72 2d 66 73 22 29 3b 0a 20   "shader-fs");. 
00000540: 20 20 20 76 61 72 20 76 65 72 74 65 78 53 68 61     var vertexSha
00000550: 64 65 72 20 3d 20 67 65 74 53 68 61 64 65 72 28  der = getShader(
00000560: 67 6c 2c 20 22 73 68 61 64 65 72 2d 76 73 22 29  gl, "shader-vs")
00000570: 3b 0a 0a 20 20 20 20 73 68 61 64 65 72 50 72 6f  ;..    shaderPro
00000580: 67 72 61 6d 20 3d 20 67 6c 2e 63 72 65 61 74 65  gram = gl.create
00000590: 50 72 6f 67 72 61 6d 28 29 3b 0a 20 20 20 20 67  Program();.    g
000005a0: 6c 2e 61 74 74 61 63 68 53 68 61 64 65 72 28 73  l.attachShader(s
000005b0: 68 61 64 65 72 50 72 6f 67 72 61 6d 2c 20 76 65  haderProgram, ve
000005c0: 72 74 65 78 53 68 61 64 65 72 29 3b 0a 20 20 20  rtexShader);.   
000005d0: 20 67 6c 2e 61 74 74 61 63 68 53 68 61 64 65 72   gl.attachShader
000005e0: 28 73 68 61 64 65 72 50 72 6f 67 72 61 6d 2c 20  (shaderProgram, 
000005f0: 66 72 61 67 6d 65 6e 74 53 68 61 64 65 72 29 3b  fragmentShader);
00000600: 0a 20 20 20 20 67 6c 2e 6c 69 6e 6b 50 72 6f 67  .    gl.linkProg
00000610: 72 61 6d 28 73 68 61 64 65 72 50 72 6f 67 72 61  ram(shaderProgra
00000620: 6d 29 3b 0a 0a 20 20 20 20 69 66 20 28 21 67 6c  m);..    if (!gl
00000630: 2e 67 65 74 50 72 6f 67 72 61 6d 50 61 72 61 6d  .getProgramParam
00000640: 65 74 65 72 28 73 68 61 64 65 72 50 72 6f 67 72  eter(shaderProgr
00000650: 61 6d 2c 20 67 6c 2e 4c 49 4e 4b 5f 53 54 41 54  am, gl.LINK_STAT
00000660: 55 53 29 29 20 7b 0a 20 20 20 20 20 20 61 6c 65  US)) {.      ale
00000670: 72 74 28 22 43 6f 75 6c 64 20 6e 6f 74 20 69 6e  rt("Could not in
00000680: 69 74 69 61 6c 69 73 65 20 73 68 61 64 65 72 73  itialise shaders
00000690: 22 29 3b 0a 20 20 20 20 7d 0a 0a 20 20 20 20 67  ");.    }..    g
000006a0: 6c 2e 75 73 65 50 72 6f 67 72 61 6d 28 73 68 61  l.useProgram(sha
000006b0: 64 65 72 50 72 6f 67 72 61 6d 29 3b 0a 0a 20 20  derProgram);..  
000006c0: 20 20 73 68 61 64 65 72 50 72 6f 67 72 61 6d 2e    shaderProgram.
000006d0: 76 65 72 74 65 78 50 6f 73 69 74 69 6f 6e 41 74  vertexPositionAt
000006e0: 74 72 69 62 75 74 65 20 3d 20 67 6c 2e 67 65 74  tribute = gl.get
000006f0: 41 74 74 72 69 62 4c 6f 63 61 74 69 6f 6e 28 73  AttribLocation(s
00000700: 68 61 64 65 72 50 72 6f 67 72 61 6d 2c 20 22 61  haderProgram, "a
00000710: 56 65 72 74 65 78 50 6f 73 69 74 69 6f 6e 22 29  VertexPosition")
00000720: 3b 0a 20 20 20 20 67 6c 2e 65 6e 61 62 6c 65 56  ;.    gl.enableV
00000730: 65 72 74 65 78 41 74 74 72 69 62 41 72 72 61 79  ertexAttribArray
00000740: 28 73 68 61 64 65 72 50 72 6f 67 72 61 6d 2e 76  (shaderProgram.v
00000750: 65 72 74 65 78 50 6f 73 69 74 69 6f 6e 41 74 74  ertexPositionAtt
00000760: 72 69 62 75 74 65 29 3b 0a 0a 20 20 20 20 73 68  ribute);..    sh
00000770: 61 64 65 72 50 72 6f 67 72 61 6d 2e 76 65 72 74  aderProgram.vert
00000780: 65 78 43 6f 6c 6f 72 41 74 74 72 69 62 75 74 65  exColorAttribute
00000790: 20 3d 20 67 6c 2e 67 65 74 41 74 74 72 69 62 4c   = gl.getAttribL
000007a0: 6f 63 61 74 69 6f 6e 28 73 68 61 64 65 72 50 72  ocation(shaderPr
000007b0: 6f 67 72 61 6d 2c 20 22 61 56 65 72 74 65 78 43  ogram, "aVertexC
000007c0: 6f 6c 6f 72 22 29 3b 0a 20 20 20 20 67 6c 2e 65  olor");.    gl.e
000007d0: 6e 61 62 6c 65 56 65 72 74 65 78 41 74 74 72 69  nableVertexAttri
000007e0: 62 41 72 72 61 79 28 73 68 61 64 65 72 50 72 6f  bArray(shaderPro
000007f0: 67 72 61 6d 2e 76 65 72 74 65 78 43 6f 6c 6f 72  gram.vertexColor
00000800: 41 74 74 72 69 62 75 74 65 29 3b 0a 0a 20 20 20  Attribute);..   
00000810: 20 73 68 61 64 65 72 50 72 6f 67 72 61 6d 2e 70   shaderProgram.p
00000820: 4d 61 74 72 69 78 55 6e 69 66 6f 72 6d 20 3d 20  MatrixUniform = 
00000830: 67 6c 2e 67 65 74 55 6e 69 66 6f 72 6d 4c 6f 63  gl.getUniformLoc
00000840: 61 74 69 6f 6e 28 73 68 61 64 65 72 50 72 6f 67  ation(shaderProg
00000850: 72 61 6d 2c 20 22 75 50 4d 61 74 72 69 78 22 29  ram, "uPMatrix")
00000860: 3b 0a 20 20 20 20 73 68 61 64 65 72 50 72 6f 67  ;.    shaderProg
00000870: 72 61 6d 2e 6d 76 4d 61 74 72 69 78 55 6e 69 66  ram.mvMatrixUnif
00000880: 6f 72 6d 20 3d 20 67 6c 2e 67 65 74 55 6e 69 66  orm = gl.getUnif
00000890: 6f 72 6d 4c 6f 63 61 74 69 6f 6e 28 73 68 61 64  ormLocation(shad
000008a0: 65 72 50 72 6f 67 72 61 6d 2c 20 22 75 4d 56 4d  erProgram, "uMVM
000008b0: 61 74 72 69 78 22 29 3b 0a 20 20 7d 0a 0a 20 20  atrix");.  }..  
000008c0: 66 75 6e 63 74 69 6f 6e 20 64 65 67 54 6f 52 61  function degToRa
000008d0: 64 28 64 65 67 72 65 65 73 29 20 7b 0a 20 20 20  d(degrees) {.   
000008e0: 20 20 20 20 20 72 65 74 75 72 6e 20 64 65 67 72       return degr
000008f0: 65 65 73 20 2a 20 4d 61 74 68 2e 50 49 20 2f 20  ees * Math.PI / 
00000900: 31 38 30 3b 0a 20 20 20 20 7d 0a 0a 20 20 66 75  180;.    }..  fu
00000910: 6e 63 74 69 6f 6e 20 67 65 74 53 68 61 64 65 72  nction getShader
00000920: 28 67 6c 2c 20 69 64 29 20 7b 0a 20 20 20 20 20  (gl, id) {.     
00000930: 20 76 61 72 20 73 68 61 64 65 72 53 63 72 69 70   var shaderScrip
00000940: 74 20 3d 20 64 6f 63 75 6d 65 6e 74 2e 67 65 74  t = document.get
00000950: 45 6c 65 6d 65 6e 74 42 79 49 64 28 69 64 29 3b  ElementById(id);
00000960: 0a 20 20 20 20 20 20 69 66 20 28 21 73 68 61 64  .      if (!shad
00000970: 65 72 53 63 72 69 70 74 29 20 7b 0a 20 20 20 20  erScript) {.    
00000980: 20 20 20 20 20 20 72 65 74 75 72 6e 20 6e 75 6c        return nul
00000990: 6c 3b 0a 20 20 20 20 20 20 7d 0a 0a 20 20 20 20  l;.      }..    
000009a0: 20 20 76 61 72 20 73 74 72 20 3d 20 22 22 3b 0a    var str = "";.
000009b0: 20 20 20 20 20 20 76 61 72 20 6b 20 3d 20 73 68        var k = sh
000009c0: 61 64 65 72 53 63 72 69 70 74 2e 66 69 72 73 74  aderScript.first
000009d0: 43 68 69 6c 64 3b 0a 20 20 20 20 20 20 77 68 69  Child;.      whi
000009e0: 6c 65 20 28 6b 29 20 7b 0a 20 20 20 20 20 20 20  le (k) {.       
000009f0: 20 20 20 69 66 20 28 6b 2e 6e 6f 64 65 54 79 70     if (k.nodeTyp
00000a00: 65 20 3d 3d 20 33 29 0a 20 20 20 20 20 20 20 20  e == 3).        
00000a10: 20 20 20 20 20 20 73 74 72 20 2b 3d 20 6b 2e 74        str += k.t
00000a20: 65 78 74 43 6f 6e 74 65 6e 74 3b 0a 20 20 20 20  extContent;.    
00000a30: 20 20 20 20 20 20 6b 20 3d 20 6b 2e 6e 65 78 74        k = k.next
00000a40: 53 69 62 6c 69 6e 67 3b 0a 20 20 20 20 20 20 7d  Sibling;.      }
00000a50: 0a 0a 20 20 20 20 20 20 76 61 72 20 73 68 61 64  ..      var shad
00000a60: 65 72 3b 0a 20 20 20 20 20 20 69 66 20 28 73 68  er;.      if (sh
00000a70: 61 64 65 72 53 63 72 69 70 74 2e 74 79 70 65 20  aderScript.type 
00000a80: 3d 3d 20 22 78 2d 73 68 61 64 65 72 2f 78 2d 66  == "x-shader/x-f
00000a90: 72 61 67 6d 65 6e 74 22 29 20 7b 0a 20 20 20 20  ragment") {.    
00000aa0: 20 20 20 20 20 20 73 68 61 64 65 72 20 3d 20 67        shader = g
00000ab0: 6c 2e 63 72 65 61 74 65 53 68 61 64 65 72 28 67  l.createShader(g
00000ac0: 6c 2e 46 52 41 47 4d 45 4e 54 5f 53 48 41 44 45  l.FRAGMENT_SHADE
00000ad0: 52 29 3b 0a 20 20 20 20 20 20 7d 20 65 6c 73 65  R);.      } else
00000ae0: 20 69 66 20 28 73 68 61 64 65 72 53 63 72 69 70   if (shaderScrip
00000af0: 74 2e 74 79 70 65 20 3d 3d 20 22 78 2d 73 68 61  t.type == "x-sha
00000b00: 64 65 72 2f 78 2d 76 65 72 74 65 78 22 29 20 7b  der/x-vertex") {
00000b10: 0a 20 20 20 20 20 20 20 20 20 20 73 68 61 64 65  .          shade
00000b20: 72 20 3d 20 67 6c 2e 63 72 65 61 74 65 53 68 61  r = gl.createSha
00000b30: 64 65 72 28 67 6c 2e 56 45 52 54 45 58 5f 53 48  der(gl.VERTEX_SH
00000b40: 41 44 45 52 29 3b 0a 20 20 20 20 20 20 7d 20 65  ADER);.      } e
00000b50: 6c 73 65 20 7b 0a 20 20 20 20 20 20 20 20 20 20  lse {.          
00000b60: 72 65 74 75 72 6e 20 6e 75 6c 6c 3b 0a 20 20 20  return null;.   
00000b70: 20 20 20 7d 0a 0a 20 20 20 20 20 20 67 6c 2e 73     }..      gl.s
00000b80: 68 61 64 65 72 53 6f 75 72 63 65 28 73 68 61 64  haderSource(shad
00000b90: 65 72 2c 20 73 74 72 29 3b 0a 20 20 20 20 20 20  er, str);.      
00000ba0: 67 6c 2e 63 6f 6d 70 69 6c 65 53 68 61 64 65 72  gl.compileShader
00000bb0: 28 73 68 61 64 65 72 29 3b 0a 0a 20 20 20 20 20  (shader);..     
00000bc0: 20 69 66 20 28 21 67 6c 2e 67 65 74 53 68 61 64   if (!gl.getShad
00000bd0: 65 72 50 61 72 61 6d 65 74 65 72 28 73 68 61 64  erParameter(shad
00000be0: 65 72 2c 20 67 6c 2e 43 4f 4d 50 49 4c 45 5f 53  er, gl.COMPILE_S
00000bf0: 54 41 54 55 53 29 29 20 7b 0a 20 20 20 20 20 20  TATUS)) {.      
00000c00: 20 20 20 20 61 6c 65 72 74 28 67 6c 2e 67 65 74      alert(gl.get
00000c10: 53 68 61 64 65 72 49 6e 66 6f 4c 6f 67 28 73 68  ShaderInfoLog(sh
00000c20: 61 64 65 72 29 29 3b 0a 20 20 20 20 20 20 20 20  ader));.        
00000c30: 20 20 72 65 74 75 72 6e 20 6e 75 6c 6c 3b 0a 20    return null;. 
00000c40: 20 20 20 20 20 7d 0a 0a 20 20 20 20 20 20 72 65       }..      re
00000c50: 74 75 72 6e 20 73 68 61 64 65 72 3b 0a 20 20 7d  turn shader;.  }
00000c60: 0a 0a 66 75 6e 63 74 69 6f 6e 20 69 6e 69 74 43  ..function initC
00000c70: 6f 6c 6f 72 28 72 6f 77 2c 20 73 69 7a 65 29 20  olor(row, size) 
00000c80: 7b 0a 0a 20 20 20 20 63 6f 6c 6f 72 42 75 66 66  {..    colorBuff
00000c90: 65 72 20 3d 20 67 6c 2e 63 72 65 61 74 65 42 75  er = gl.createBu
00000ca0: 66 66 65 72 28 29 3b 0a 20 20 20 20 67 6c 2e 62  ffer();.    gl.b
00000cb0: 69 6e 64 42 75 66 66 65 72 28 67 6c 2e 41 52 52  indBuffer(gl.ARR
00000cc0: 41 59 5f 42 55 46 46 45 52 2c 20 63 6f 6c 6f 72  AY_BUFFER, color
00000cd0: 42 75 66 66 65 72 29 3b 0a 20 20 20 20 63 6f 6c  Buffer);.    col
00000ce0: 6f 72 73 20 3d 20 5b 5d 0a 20 20 20 20 66 6f 72  ors = [].    for
00000cf0: 20 28 76 61 72 20 69 3d 30 3b 20 69 20 3c 20 73   (var i=0; i < s
00000d00: 69 7a 65 3b 20 69 2b 2b 29 20 7b 0a 20 20 20 20  ize; i++) {.    
00000d10: 20 20 63 6f 6c 6f 72 73 20 3d 20 63 6f 6c 6f 72    colors = color
00000d20: 73 2e 63 6f 6e 63 61 74 28 72 6f 77 29 3b 0a 20  s.concat(row);. 
00000d30: 20 20 20 7d 0a 20 20 20 20 67 6c 2e 62 75 66 66     }.    gl.buff
00000d40: 65 72 44 61 74 61 28 67 6c 2e 41 52 52 41 59 5f  erData(gl.ARRAY_
00000d50: 42 55 46 46 45 52 2c 20 6e 65 77 20 46 6c 6f 61  BUFFER, new Floa
00000d60: 74 33 32 41 72 72 61 79 28 63 6f 6c 6f 72 73 29  t32Array(colors)
00000d70: 2c 20 67 6c 2e 53 54 41 54 49 43 5f 44 52 41 57  , gl.STATIC_DRAW
00000d80: 29 3b 0a 20 20 20 20 63 6f 6c 6f 72 42 75 66 66  );.    colorBuff
00000d90: 65 72 2e 69 74 65 6d 53 69 7a 65 20 3d 20 34 3b  er.itemSize = 4;
00000da0: 0a 20 20 20 20 63 6f 6c 6f 72 42 75 66 66 65 72  .    colorBuffer
00000db0: 2e 6e 75 6d 49 74 65 6d 73 20 3d 20 73 69 7a 65  .numItems = size
00000dc0: 3b 0a 20 20 20 20 72 65 74 75 72 6e 20 63 6f 6c  ;.    return col
00000dd0: 6f 72 42 75 66 66 65 72 3b 0a 7d 0a 0a 76 61 72  orBuffer;.}..var
00000de0: 20 72 65 64 43 6f 6c 6f 72 3b 0a 76 61 72 20 67   redColor;.var g
00000df0: 72 65 65 6e 43 6f 6c 6f 72 3b 0a 76 61 72 20 62  reenColor;.var b
00000e00: 6c 75 65 43 6f 6c 6f 72 3b 0a 0a 66 75 6e 63 74  lueColor;..funct
00000e10: 69 6f 6e 20 69 6e 69 74 43 6f 6c 6f 72 73 28 29  ion initColors()
00000e20: 20 7b 0a 20 20 20 20 72 65 64 43 6f 6c 6f 72 20   {.    redColor 
00000e30: 3d 20 69 6e 69 74 43 6f 6c 6f 72 28 5b 30 2e 39  = initColor([0.9
00000e40: 2c 30 2e 30 35 2c 30 2e 30 35 2c 31 5d 2c 34 29  ,0.05,0.05,1],4)
00000e50: 3b 0a 20 20 20 20 67 72 65 65 6e 43 6f 6c 6f 72  ;.    greenColor
00000e60: 20 3d 20 69 6e 69 74 43 6f 6c 6f 72 28 5b 30 2e   = initColor([0.
00000e70: 30 35 2c 30 2e 39 2c 30 2e 30 35 2c 31 2e 30 5d  05,0.9,0.05,1.0]
00000e80: 2c 34 29 3b 0a 20 20 20 20 62 6c 75 65 43 6f 6c  ,4);.    blueCol
00000e90: 6f 72 20 3d 20 69 6e 69 74 43 6f 6c 6f 72 28 5b  or = initColor([
00000ea0: 30 2e 30 35 2c 30 2e 30 35 2c 30 2e 39 2c 31 2e  0.05,0.05,0.9,1.
00000eb0: 30 5d 2c 34 29 3b 0a 0a 7d 0a 0a 76 61 72 20 61  0],4);..}..var a
00000ec0: 72 72 6f 77 5f 68 65 61 72 3b 0a 76 61 72 20 61  rrow_hear;.var a
00000ed0: 72 72 6f 77 5f 62 6f 64 79 3b 0a 0a 66 75 6e 63  rrow_body;..func
00000ee0: 74 69 6f 6e 20 69 6e 69 74 42 75 66 66 65 72 73  tion initBuffers
00000ef0: 28 29 20 7b 0a 20 20 20 20 61 72 72 6f 77 5f 68  () {.    arrow_h
00000f00: 65 61 64 20 3d 20 67 6c 2e 63 72 65 61 74 65 42  ead = gl.createB
00000f10: 75 66 66 65 72 28 29 3b 0a 0a 20 20 20 20 67 6c  uffer();..    gl
00000f20: 2e 62 69 6e 64 42 75 66 66 65 72 28 67 6c 2e 41  .bindBuffer(gl.A
00000f30: 52 52 41 59 5f 42 55 46 46 45 52 2c 20 61 72 72  RRAY_BUFFER, arr
00000f40: 6f 77 5f 68 65 61 64 29 3b 0a 0a 20 20 20 20 76  ow_head);..    v
00000f50: 61 72 20 76 65 72 74 69 63 65 73 20 3d 20 5b 0a  ar vertices = [.
00000f60: 20 20 20 20 20 20 20 20 20 30 2e 30 35 2c 20 20           0.05,  
00000f70: 30 2e 39 35 2c 20 20 30 2e 30 2c 0a 20 20 20 20  0.95,  0.0,.    
00000f80: 20 20 20 20 20 30 2e 30 2c 20 20 31 2e 30 2c 20       0.0,  1.0, 
00000f90: 20 20 30 2e 30 2c 0a 20 20 20 20 20 20 20 20 2d    0.0,.        -
00000fa0: 30 2e 30 35 2c 20 20 30 2e 39 35 2c 20 20 30 2e  0.05,  0.95,  0.
00000fb0: 30 0a 20 20 20 20 5d 3b 0a 0a 20 20 20 20 67 6c  0.    ];..    gl
00000fc0: 2e 62 75 66 66 65 72 44 61 74 61 28 67 6c 2e 41  .bufferData(gl.A
00000fd0: 52 52 41 59 5f 42 55 46 46 45 52 2c 20 6e 65 77  RRAY_BUFFER, new
00000fe0: 20 46 6c 6f 61 74 33 32 41 72 72 61 79 28 76 65   Float32Array(ve
00000ff0: 72 74 69 63 65 73 29 2c 20 67 6c 2e 53 54 41 54  rtices), gl.STAT
00001000: 49 43 5f 44 52 41 57 29 3b 0a 0a 20 20 20 20 61  IC_DRAW);..    a
00001010: 72 72 6f 77 5f 68 65 61 64 2e 69 74 65 6d 53 69  rrow_head.itemSi
00001020: 7a 65 20 3d 20 33 3b 0a 20 20 20 20 61 72 72 6f  ze = 3;.    arro
00001030: 77 5f 68 65 61 64 2e 6e 75 6d 49 74 65 6d 73 20  w_head.numItems 
00001040: 3d 20 33 3b 0a 0a 20 20 20 20 61 72 72 6f 77 5f  = 3;..    arrow_
00001050: 62 6f 64 79 20 3d 20 67 6c 2e 63 72 65 61 74 65  body = gl.create
00001060: 42 75 66 66 65 72 28 29 3b 0a 0a 20 20 20 20 67  Buffer();..    g
00001070: 6c 2e 62 69 6e 64 42 75 66 66 65 72 28 67 6c 2e  l.bindBuffer(gl.
00001080: 41 52 52 41 59 5f 42 55 46 46 45 52 2c 20 61 72  ARRAY_BUFFER, ar
00001090: 72 6f 77 5f 62 6f 64 79 29 3b 0a 0a 20 20 20 20  row_body);..    
000010a0: 76 61 72 20 76 65 72 74 69 63 65 73 20 3d 20 5b  var vertices = [
000010b0: 0a 20 20 20 20 20 20 20 20 20 30 2e 30 31 2c 20  .         0.01, 
000010c0: 20 30 2e 39 37 35 2c 20 20 20 20 30 2e 30 2c 0a   0.975,    0.0,.
000010d0: 20 20 20 20 20 20 20 20 2d 30 2e 30 31 2c 20 20          -0.01,  
000010e0: 30 2e 39 37 35 2c 20 20 30 2e 30 2c 0a 20 20 20  0.975,  0.0,.   
000010f0: 20 20 20 20 20 20 30 2e 30 31 2c 20 20 30 2e 30        0.01,  0.0
00001100: 2c 20 20 30 2e 30 2c 0a 20 20 20 20 20 20 20 20  ,  0.0,.        
00001110: 2d 30 2e 30 31 2c 20 20 30 2e 30 2c 20 20 20 20  -0.01,  0.0,    
00001120: 30 2e 30 0a 20 20 20 20 5d 3b 0a 0a 20 20 20 20  0.0.    ];..    
00001130: 67 6c 2e 62 75 66 66 65 72 44 61 74 61 28 67 6c  gl.bufferData(gl
00001140: 2e 41 52 52 41 59 5f 42 55 46 46 45 52 2c 20 6e  .ARRAY_BUFFER, n
00001150: 65 77 20 46 6c 6f 61 74 33 32 41 72 72 61 79 28  ew Float32Array(
00001160: 76 65 72 74 69 63 65 73 29 2c 20 67 6c 2e 53 54  vertices), gl.ST
00001170: 41 54 49 43 5f 44 52 41 57 29 3b 0a 0a 20 20 20  ATIC_DRAW);..   
00001180: 20 61 72 72 6f 77 5f 62 6f 64 79 2e 69 74 65 6d   arrow_body.item
00001190: 53 69 7a 65 20 3d 20 33 3b 0a 20 20 20 20 61 72  Size = 3;.    ar
000011a0: 72 6f 77 5f 62 6f 64 79 2e 6e 75 6d 49 74 65 6d  row_body.numItem
000011b0: 73 20 3d 20 34 3b 0a 0a 20 20 7d 20 20 0a 0a 20  s = 4;..  }  .. 
000011c0: 20 66 75 6e 63 74 69 6f 6e 20 73 65 74 4d 61 74   function setMat
000011d0: 72 69 78 55 6e 69 66 6f 72 6d 73 28 29 20 7b 0a  rixUniforms() {.
000011e0: 20 20 20 20 67 6c 2e 75 6e 69 66 6f 72 6d 4d 61      gl.uniformMa
000011f0: 74 72 69 78 34 66 76 28 73 68 61 64 65 72 50 72  trix4fv(shaderPr
00001200: 6f 67 72 61 6d 2e 70 4d 61 74 72 69 78 55 6e 69  ogram.pMatrixUni
00001210: 66 6f 72 6d 2c 20 66 61 6c 73 65 2c 20 70 4d 61  form, false, pMa
00001220: 74 72 69 78 29 3b 0a 20 20 20 20 67 6c 2e 75 6e  trix);.    gl.un
00001230: 69 66 6f 72 6d 4d 61 74 72 69 78 34 66 76 28 73  iformMatrix4fv(s
00001240: 68 61 64 65 72 50 72 6f 67 72 61 6d 2e 6d 76 4d  haderProgram.mvM
00001250: 61 74 72 69 78 55 6e 69 66 6f 72 6d 2c 20 66 61  atrixUniform, fa
00001260: 6c 73 65 2c 20 6d 76 4d 61 74 72 69 78 29 3b 0a  lse, mvMatrix);.
00001270: 20 20 7d 0a 0a 0a 66 75 6e 63 74 69 6f 6e 20 64    }...function d
00001280: 72 61 77 48 61 6c 66 41 72 72 6f 77 28 63 6f 6c  rawHalfArrow(col
00001290: 6f 72 29 20 7b 0a 2f 2f 20 61 64 64 20 0a 20 20  or) {.// add .  
000012a0: 20 20 67 6c 2e 62 69 6e 64 42 75 66 66 65 72 28    gl.bindBuffer(
000012b0: 67 6c 2e 41 52 52 41 59 5f 42 55 46 46 45 52 2c  gl.ARRAY_BUFFER,
000012c0: 20 61 72 72 6f 77 5f 62 6f 64 79 29 3b 0a 20 20   arrow_body);.  
000012d0: 20 20 67 6c 2e 76 65 72 74 65 78 41 74 74 72 69    gl.vertexAttri
000012e0: 62 50 6f 69 6e 74 65 72 28 73 68 61 64 65 72 50  bPointer(shaderP
000012f0: 72 6f 67 72 61 6d 2e 76 65 72 74 65 78 50 6f 73  rogram.vertexPos
00001300: 69 74 69 6f 6e 41 74 74 72 69 62 75 74 65 2c 20  itionAttribute, 
00001310: 61 72 72 6f 77 5f 62 6f 64 79 2e 69 74 65 6d 53  arrow_body.itemS
00001320: 69 7a 65 2c 20 67 6c 2e 46 4c 4f 41 54 2c 20 66  ize, gl.FLOAT, f
00001330: 61 6c 73 65 2c 20 30 2c 20 30 29 3b 0a 0a 20 20  alse, 0, 0);..  
00001340: 20 20 67 6c 2e 62 69 6e 64 42 75 66 66 65 72 28    gl.bindBuffer(
00001350: 67 6c 2e 41 52 52 41 59 5f 42 55 46 46 45 52 2c  gl.ARRAY_BUFFER,
00001360: 20 63 6f 6c 6f 72 29 3b 0a 20 20 20 20 67 6c 2e   color);.    gl.
00001370: 76 65 72 74 65 78 41 74 74 72 69 62 50 6f 69 6e  vertexAttribPoin
00001380: 74 65 72 28 73 68 61 64 65 72 50 72 6f 67 72 61  ter(shaderProgra
00001390: 6d 2e 76 65 72 74 65 78 43 6f 6c 6f 72 41 74 74  m.vertexColorAtt
000013a0: 72 69 62 75 74 65 2c 20 63 6f 6c 6f 72 2e 69 74  ribute, color.it
000013b0: 65 6d 53 69 7a 65 2c 20 67 6c 2e 46 4c 4f 41 54  emSize, gl.FLOAT
000013c0: 2c 20 66 61 6c 73 65 2c 20 30 2c 20 30 29 3b 0a  , false, 0, 0);.
000013d0: 0a 20 20 20 20 73 65 74 4d 61 74 72 69 78 55 6e  .    setMatrixUn
000013e0: 69 66 6f 72 6d 73 28 29 3b 0a 0a 20 20 20 20 67  iforms();..    g
000013f0: 6c 2e 64 72 61 77 41 72 72 61 79 73 28 67 6c 2e  l.drawArrays(gl.
00001400: 54 52 49 41 4e 47 4c 45 5f 53 54 52 49 50 2c 20  TRIANGLE_STRIP, 
00001410: 30 2c 20 61 72 72 6f 77 5f 62 6f 64 79 2e 6e 75  0, arrow_body.nu
00001420: 6d 49 74 65 6d 73 29 3b 0a 0a 0a 20 20 20 20 67  mItems);...    g
00001430: 6c 2e 62 69 6e 64 42 75 66 66 65 72 28 67 6c 2e  l.bindBuffer(gl.
00001440: 41 52 52 41 59 5f 42 55 46 46 45 52 2c 20 61 72  ARRAY_BUFFER, ar
00001450: 72 6f 77 5f 68 65 61 64 29 3b 0a 20 20 20 20 67  row_head);.    g
00001460: 6c 2e 76 65 72 74 65 78 41 74 74 72 69 62 50 6f  l.vertexAttribPo
00001470: 69 6e 74 65 72 28 73 68 61 64 65 72 50 72 6f 67  inter(shaderProg
00001480: 72 61 6d 2e 76 65 72 74 65 78 50 6f 73 69 74 69  ram.vertexPositi
00001490: 6f 6e 41 74 74 72 69 62 75 74 65 2c 20 61 72 72  onAttribute, arr
000014a0: 6f 77 5f 68 65 61 64 2e 69 74 65 6d 53 69 7a 65  ow_head.itemSize
000014b0: 2c 20 67 6c 2e 46 4c 4f 41 54 2c 20 66 61 6c 73  , gl.FLOAT, fals
000014c0: 65 2c 20 30 2c 20 30 29 3b 0a 0a 20 20 20 20 67  e, 0, 0);..    g
000014d0: 6c 2e 62 69 6e 64 42 75 66 66 65 72 28 67 6c 2e  l.bindBuffer(gl.
000014e0: 41 52 52 41 59 5f 42 55 46 46 45 52 2c 20 63 6f  ARRAY_BUFFER, co
000014f0: 6c 6f 72 29 3b 0a 20 20 20 20 67 6c 2e 76 65 72  lor);.    gl.ver
00001500: 74 65 78 41 74 74 72 69 62 50 6f 69 6e 74 65 72  texAttribPointer
00001510: 28 73 68 61 64 65 72 50 72 6f 67 72 61 6d 2e 76  (shaderProgram.v
00001520: 65 72 74 65 78 43 6f 6c 6f 72 41 74 74 72 69 62  ertexColorAttrib
00001530: 75 74 65 2c 20 63 6f 6c 6f 72 2e 69 74 65 6d 53  ute, color.itemS
00001540: 69 7a 65 2c 20 67 6c 2e 46 4c 4f 41 54 2c 20 66  ize, gl.FLOAT, f
00001550: 61 6c 73 65 2c 20 30 2c 20 30 29 3b 0a 0a 20 20  alse, 0, 0);..  
00001560: 20 20 73 65 74 4d 61 74 72 69 78 55 6e 69 66 6f    setMatrixUnifo
00001570: 72 6d 73 28 29 3b 0a 0a 20 20 20 20 67 6c 2e 64  rms();..    gl.d
00001580: 72 61 77 41 72 72 61 79 73 28 67 6c 2e 54 52 49  rawArrays(gl.TRI
00001590: 41 4e 47 4c 45 5f 53 54 52 49 50 2c 20 30 2c 20  ANGLE_STRIP, 0, 
000015a0: 61 72 72 6f 77 5f 68 65 61 64 2e 6e 75 6d 49 74  arrow_head.numIt
000015b0: 65 6d 73 29 3b 0a 7d 0a 0a 66 75 6e 63 74 69 6f  ems);.}..functio
000015c0: 6e 20 64 72 61 77 41 72 72 6f 77 28 63 6f 6c 6f  n drawArrow(colo
000015d0: 72 29 20 7b 0a 20 20 20 20 6d 76 50 75 73 68 4d  r) {.    mvPushM
000015e0: 61 74 72 69 78 28 29 3b 0a 20 20 20 20 64 72 61  atrix();.    dra
000015f0: 77 48 61 6c 66 41 72 72 6f 77 28 63 6f 6c 6f 72  wHalfArrow(color
00001600: 29 3b 0a 20 20 20 20 6d 61 74 34 2e 72 6f 74 61  );.    mat4.rota
00001610: 74 65 28 6d 76 4d 61 74 72 69 78 2c 20 64 65 67  te(mvMatrix, deg
00001620: 54 6f 52 61 64 28 39 30 29 2c 20 5b 30 2c 20 31  ToRad(90), [0, 1
00001630: 2c 20 30 5d 29 3b 0a 20 20 20 20 64 72 61 77 48  , 0]);.    drawH
00001640: 61 6c 66 41 72 72 6f 77 28 63 6f 6c 6f 72 29 3b  alfArrow(color);
00001650: 0a 20 20 20 20 6d 76 50 6f 70 4d 61 74 72 69 78  .    mvPopMatrix
00001660: 28 29 3b 0a 7d 0a 0a 0a 66 75 6e 63 74 69 6f 6e  ();.}...function
00001670: 20 64 72 61 77 41 78 69 73 28 29 20 7b 0a 0a 20   drawAxis() {.. 
00001680: 20 20 20 6d 76 50 75 73 68 4d 61 74 72 69 78 28     mvPushMatrix(
00001690: 29 3b 20 20 20 0a 0a 20 20 20 20 6d 61 74 34 2e  );   ..    mat4.
000016a0: 72 6f 74 61 74 65 28 6d 76 4d 61 74 72 69 78 2c  rotate(mvMatrix,
000016b0: 20 64 65 67 54 6f 52 61 64 28 39 30 29 2c 20 5b   degToRad(90), [
000016c0: 31 2c 20 30 2c 20 30 5d 29 3b 0a 20 20 20 20 2f  1, 0, 0]);.    /
000016d0: 2f 20 79 0a 20 20 20 20 64 72 61 77 41 72 72 6f  / y.    drawArro
000016e0: 77 28 67 72 65 65 6e 43 6f 6c 6f 72 29 3b 0a 0a  w(greenColor);..
000016f0: 20 20 20 20 6d 61 74 34 2e 72 6f 74 61 74 65 28      mat4.rotate(
00001700: 6d 76 4d 61 74 72 69 78 2c 20 64 65 67 54 6f 52  mvMatrix, degToR
00001710: 61 64 28 2d 39 30 29 2c 20 5b 30 2c 20 30 2c 20  ad(-90), [0, 0, 
00001720: 31 5d 29 3b 0a 0a 20 20 20 20 2f 2f 20 78 0a 20  1]);..    // x. 
00001730: 20 20 20 64 72 61 77 41 72 72 6f 77 28 72 65 64     drawArrow(red
00001740: 43 6f 6c 6f 72 29 3b 0a 0a 20 20 20 20 6d 61 74  Color);..    mat
00001750: 34 2e 72 6f 74 61 74 65 28 6d 76 4d 61 74 72 69  4.rotate(mvMatri
00001760: 78 2c 20 64 65 67 54 6f 52 61 64 28 39 30 29 2c  x, degToRad(90),
00001770: 20 5b 30 2c 20 30 2c 20 31 5d 29 3b 0a 20 20 20   [0, 0, 1]);.   
00001780: 20 6d 61 74 34 2e 72 6f 74 61 74 65 28 6d 76 4d   mat4.rotate(mvM
00001790: 61 74 72 69 78 2c 20 64 65 67 54 6f 52 61 64 28  atrix, degToRad(
000017a0: 39 30 29 2c 20 5b 31 2c 20 30 2c 20 30 5d 29 3b  90), [1, 0, 0]);
000017b0: 0a 0a 20 20 20 20 2f 2f 20 5a 0a 20 20 20 20 64  ..    // Z.    d
000017c0: 72 61 77 41 72 72 6f 77 28 62 6c 75 65 43 6f 6c  rawArrow(blueCol
000017d0: 6f 72 29 3b 0a 0a 20 20 20 20 6d 76 50 6f 70 4d  or);..    mvPopM
000017e0: 61 74 72 69 78 28 29 3b 0a 0a 7d 0a 0a 0a 0a 66  atrix();..}....f
000017f0: 75 6e 63 74 69 6f 6e 20 64 72 61 77 53 63 65 6e  unction drawScen
00001800: 65 28 29 20 7b 0a 0a 20 20 20 20 67 6c 2e 76 69  e() {..    gl.vi
00001810: 65 77 70 6f 72 74 28 30 2c 20 30 2c 20 67 6c 2e  ewport(0, 0, gl.
00001820: 76 69 65 77 70 6f 72 74 57 69 64 74 68 2c 20 67  viewportWidth, g
00001830: 6c 2e 76 69 65 77 70 6f 72 74 48 65 69 67 68 74  l.viewportHeight
00001840: 29 3b 0a 20 20 20 20 67 6c 2e 63 6c 65 61 72 28  );.    gl.clear(
00001850: 67 6c 2e 43 4f 4c 4f 52 5f 42 55 46 46 45 52 5f  gl.COLOR_BUFFER_
00001860: 42 49 54 20 7c 20 67 6c 2e 44 45 50 54 48 5f 42  BIT | gl.DEPTH_B
00001870: 55 46 46 45 52 5f 42 49 54 29 3b 0a 20 20 0a 20  UFFER_BIT);.  . 
00001880: 20 20 20 6d 61 74 34 2e 70 65 72 73 70 65 63 74     mat4.perspect
00001890: 69 76 65 28 34 35 2c 20 67 6c 2e 76 69 65 77 70  ive(45, gl.viewp
000018a0: 6f 72 74 57 69 64 74 68 20 2f 20 67 6c 2e 76 69  ortWidth / gl.vi
000018b0: 65 77 70 6f 72 74 48 65 69 67 68 74 2c 20 30 2e  ewportHeight, 0.
000018c0: 31 2c 20 31 30 30 2e 30 2c 20 70 4d 61 74 72 69  1, 100.0, pMatri
000018d0: 78 29 3b 0a 0a 20 20 20 20 6d 61 74 34 2e 69 64  x);..    mat4.id
000018e0: 65 6e 74 69 74 79 28 6d 76 4d 61 74 72 69 78 29  entity(mvMatrix)
000018f0: 3b 0a 20 20 20 20 6d 61 74 34 2e 74 72 61 6e 73  ;.    mat4.trans
00001900: 6c 61 74 65 28 6d 76 4d 61 74 72 69 78 2c 20 5b  late(mvMatrix, [
00001910: 2d 31 2e 35 2c 20 30 2e 30 2c 20 2d 37 2e 30 5d  -1.5, 0.0, -7.0]
00001920: 29 3b 0a 0a 20 20 20 20 6d 76 50 75 73 68 4d 61  );..    mvPushMa
00001930: 74 72 69 78 28 29 3b 0a 63 6f 6e 73 6f 6c 65 2e  trix();.console.
00001940: 6c 6f 67 28 22 64 72 61 77 22 29 3b 0a 20 20 20  log("draw");.   
00001950: 20 69 66 20 28 67 79 72 6f 29 20 7b 0a 20 20 20   if (gyro) {.   
00001960: 20 78 20 3d 20 28 67 79 72 6f 2e 78 20 2f 20 30   x = (gyro.x / 0
00001970: 78 66 66 66 66 29 2a 33 36 30 3b 0a 20 20 20 20  xffff)*360;.    
00001980: 63 6f 6e 73 6f 6c 65 2e 6c 6f 67 28 78 29 3b 0a  console.log(x);.
00001990: 20 20 20 20 6d 61 74 34 2e 72 6f 74 61 74 65 28      mat4.rotate(
000019a0: 6d 76 4d 61 74 72 69 78 2c 20 64 65 67 54 6f 52  mvMatrix, degToR
000019b0: 61 64 28 78 29 2c 20 5b 31 2c 20 30 2c 20 30 5d  ad(x), [1, 0, 0]
000019c0: 29 3b 0a 20 20 20 20 79 20 3d 20 28 67 79 72 6f  );.    y = (gyro
000019d0: 2e 79 20 2f 20 30 78 66 66 66 66 29 2a 33 36 30  .y / 0xffff)*360
000019e0: 3b 0a 20 20 20 20 63 6f 6e 73 6f 6c 65 2e 6c 6f  ;.    console.lo
000019f0: 67 28 79 29 3b 0a 20 20 20 20 6d 61 74 34 2e 72  g(y);.    mat4.r
00001a00: 6f 74 61 74 65 28 6d 76 4d 61 74 72 69 78 2c 20  otate(mvMatrix, 
00001a10: 64 65 67 54 6f 52 61 64 28 79 29 2c 20 5b 30 2c  degToRad(y), [0,
00001a20: 20 31 2c 20 30 5d 29 3b 0a 20 20 20 20 7a 20 3d   1, 0]);.    z =
00001a30: 20 28 67 79 72 6f 2e 7a 20 2f 20 30 78 66 66 66   (gyro.z / 0xfff
00001a40: 66 29 2a 33 36 30 3b 0a 20 20 20 20 63 6f 6e 73  f)*360;.    cons
00001a50: 6f 6c 65 2e 6c 6f 67 28 7a 29 3b 0a 20 20 20 20  ole.log(z);.    
00001a60: 6d 61 74 34 2e 72 6f 74 61 74 65 28 6d 76 4d 61  mat4.rotate(mvMa
00001a70: 74 72 69 78 2c 20 64 65 67 54 6f 52 61 64 28 7a  trix, degToRad(z
00001a80: 29 2c 20 5b 30 2c 20 30 2c 20 31 5d 29 3b 0a 0a  ), [0, 0, 1]);..
00001a90: 7d 0a 0a 20 20 20 20 64 72 61 77 41 78 69 73 28  }..    drawAxis(
00001aa0: 29 3b 0a 20 20 20 20 6d 76 50 6f 70 4d 61 74 72  );.    mvPopMatr
00001ab0: 69 78 28 29 3b 0a 0a 0a 20 20 20 20 6d 61 74 34  ix();...    mat4
00001ac0: 2e 74 72 61 6e 73 6c 61 74 65 28 6d 76 4d 61 74  .translate(mvMat
00001ad0: 72 69 78 2c 20 5b 33 2e 30 2c 20 30 2e 30 2c 20  rix, [3.0, 0.0, 
00001ae0: 30 2e 30 5d 29 3b 0a 0a 20 20 20 20 6d 76 50 75  0.0]);..    mvPu
00001af0: 73 68 4d 61 74 72 69 78 28 29 3b 0a 20 20 20 20  shMatrix();.    
00001b00: 64 72 61 77 41 78 69 73 28 29 3b 0a 0a 20 20 20  drawAxis();..   
00001b10: 20 6d 76 50 6f 70 4d 61 74 72 69 78 28 29 3b 0a   mvPopMatrix();.
00001b20: 0a 2f 2f 20 20 20 20 67 6c 2e 62 69 6e 64 42 75  .//    gl.bindBu
00001b30: 66 66 65 72 28 67 6c 2e 41 52 52 41 59 5f 42 55  ffer(gl.ARRAY_BU
00001b40: 46 46 45 52 2c 20 73 71 75 61 72 65 56 65 72 74  FFER, squareVert
00001b50: 65 78 50 6f 73 69 74 69 6f 6e 42 75 66 66 65 72  exPositionBuffer
00001b60: 29 3b 0a 2f 2f 20 20 20 20 67 6c 2e 76 65 72 74  );.//    gl.vert
00001b70: 65 78 41 74 74 72 69 62 50 6f 69 6e 74 65 72 28  exAttribPointer(
00001b80: 73 68 61 64 65 72 50 72 6f 67 72 61 6d 2e 76 65  shaderProgram.ve
00001b90: 72 74 65 78 50 6f 73 69 74 69 6f 6e 41 74 74 72  rtexPositionAttr
00001ba0: 69 62 75 74 65 2c 20 73 71 75 61 72 65 56 65 72  ibute, squareVer
00001bb0: 74 65 78 50 6f 73 69 74 69 6f 6e 42 75 66 66 65  texPositionBuffe
00001bc0: 72 2e 69 74 65 6d 53 69 7a 65 2c 20 67 6c 2e 46  r.itemSize, gl.F
00001bd0: 4c 4f 41 54 2c 20 66 61 6c 73 65 2c 20 30 2c 20  LOAT, false, 0, 
00001be0: 30 29 3b 0a 0a 2f 2f 20 20 20 20 73 65 74 4d 61  0);..//    setMa
00001bf0: 74 72 69 78 55 6e 69 66 6f 72 6d 73 28 29 3b 0a  trixUniforms();.
00001c00: 0a 2f 2f 20 20 20 20 67 6c 2e 64 72 61 77 41 72  .//    gl.drawAr
00001c10: 72 61 79 73 28 67 6c 2e 54 52 49 41 4e 47 4c 45  rays(gl.TRIANGLE
00001c20: 5f 53 54 52 49 50 2c 20 30 2c 20 73 71 75 61 72  _STRIP, 0, squar
00001c30: 65 56 65 72 74 65 78 50 6f 73 69 74 69 6f 6e 42  eVertexPositionB
00001c40: 75 66 66 65 72 2e 6e 75 6d 49 74 65 6d 73 29 3b  uffer.numItems);
00001c50: 0a 0a 7d 0a 0a 66 75 6e 63 74 69 6f 6e 20 77 65  ..}..function we
00001c60: 62 47 4c 53 74 61 72 74 28 29 20 7b 0a 20 20 20  bGLStart() {.   
00001c70: 20 76 61 72 20 63 61 6e 76 61 73 20 3d 20 64 6f   var canvas = do
00001c80: 63 75 6d 65 6e 74 2e 67 65 74 45 6c 65 6d 65 6e  cument.getElemen
00001c90: 74 42 79 49 64 28 22 67 79 72 6f 2d 63 61 6e 76  tById("gyro-canv
00001ca0: 61 73 22 29 3b 0a 20 20 20 20 69 6e 69 74 47 4c  as");.    initGL
00001cb0: 28 63 61 6e 76 61 73 29 3b 0a 20 20 20 20 69 6e  (canvas);.    in
00001cc0: 69 74 53 68 61 64 65 72 73 28 29 3b 0a 20 20 20  itShaders();.   
00001cd0: 20 69 6e 69 74 43 6f 6c 6f 72 73 28 29 3b 0a 20   initColors();. 
00001ce0: 20 20 20 69 6e 69 74 42 75 66 66 65 72 73 28 29     initBuffers()
00001cf0: 3b 0a 0a 20 20 20 20 67 6c 2e 63 6c 65 61 72 43  ;..    gl.clearC
00001d00: 6f 6c 6f 72 28 30 2e 30 2c 20 30 2e 30 2c 20 30  olor(0.0, 0.0, 0
00001d10: 2e 30 2c 20 31 2e 30 29 3b 0a 20 20 20 20 67 6c  .0, 1.0);.    gl
00001d20: 2e 65 6e 61 62 6c 65 28 67 6c 2e 44 45 50 54 48  .enable(gl.DEPTH
00001d30: 5f 54 45 53 54 29 3b 0a 0a 20 20 20 20 64 72 61  _TEST);..    dra
00001d40: 77 53 63 65 6e 65 28 29 3b 0a 20 20 7d 0a 0a 0a  wScene();.  }...
00001d50: 20 20 20 20 3c 2f 73 63 72 69 70 74 3e 0a 20 20      </script>.  
00001d60: 20 3c 73 63 72 69 70 74 20 69 64 3d 22 73 68 61   <script id="sha
00001d70: 64 65 72 2d 66 73 22 20 74 79 70 65 3d 22 78 2d  der-fs" type="x-
00001d80: 73 68 61 64 65 72 2f 78 2d 66 72 61 67 6d 65 6e  shader/x-fragmen
00001d90: 74 22 3e 0a 20 20 70 72 65 63 69 73 69 6f 6e 20  t">.  precision 
00001da0: 6d 65 64 69 75 6d 70 20 66 6c 6f 61 74 3b 0a 0a  mediump float;..
00001db0: 20 20 76 61 72 79 69 6e 67 20 76 65 63 34 20 76    varying vec4 v
00001dc0: 43 6f 6c 6f 72 3b 0a 0a 20 20 76 6f 69 64 20 6d  Color;..  void m
00001dd0: 61 69 6e 28 76 6f 69 64 29 20 7b 0a 20 20 20 20  ain(void) {.    
00001de0: 67 6c 5f 46 72 61 67 43 6f 6c 6f 72 20 3d 20 76  gl_FragColor = v
00001df0: 43 6f 6c 6f 72 3b 0a 20 20 7d 0a 3c 2f 73 63 72  Color;.  }.</scr
00001e00: 69 70 74 3e 0a 0a 3c 73 63 72 69 70 74 20 69 64  ipt>..<script id
00001e10: 3d 22 73 68 61 64 65 72 2d 76 73 22 20 74 79 70  ="shader-vs" typ
00001e20: 65 3d 22 78 2d 73 68 61 64 65 72 2f 78 2d 76 65  e="x-shader/x-ve
00001e30: 72 74 65 78 22 3e 0a 20 61 74 74 72 69 62 75 74  rtex">. attribut
00001e40: 65 20 76 65 63 33 20 61 56 65 72 74 65 78 50 6f  e vec3 aVertexPo
00001e50: 73 69 74 69 6f 6e 3b 0a 20 20 61 74 74 72 69 62  sition;.  attrib
00001e60: 75 74 65 20 76 65 63 34 20 61 56 65 72 74 65 78  ute vec4 aVertex
00001e70: 43 6f 6c 6f 72 3b 0a 0a 20 20 75 6e 69 66 6f 72  Color;..  unifor
00001e80: 6d 20 6d 61 74 34 20 75 4d 56 4d 61 74 72 69 78  m mat4 uMVMatrix
00001e90: 3b 0a 20 20 75 6e 69 66 6f 72 6d 20 6d 61 74 34  ;.  uniform mat4
00001ea0: 20 75 50 4d 61 74 72 69 78 3b 0a 0a 20 20 76 61   uPMatrix;..  va
00001eb0: 72 79 69 6e 67 20 76 65 63 34 20 76 43 6f 6c 6f  rying vec4 vColo
00001ec0: 72 3b 0a 0a 20 20 76 6f 69 64 20 6d 61 69 6e 28  r;..  void main(
00001ed0: 76 6f 69 64 29 20 7b 0a 20 20 20 20 67 6c 5f 50  void) {.    gl_P
00001ee0: 6f 73 69 74 69 6f 6e 20 3d 20 75 50 4d 61 74 72  osition = uPMatr
00001ef0: 69 78 20 2a 20 75 4d 56 4d 61 74 72 69 78 20 2a  ix * uMVMatrix *
00001f00: 20 76 65 63 34 28 61 56 65 72 74 65 78 50 6f 73   vec4(aVertexPos
00001f10: 69 74 69 6f 6e 2c 20 31 2e 30 29 3b 0a 20 20 20  ition, 1.0);.   
00001f20: 20 76 43 6f 6c 6f 72 20 3d 20 61 56 65 72 74 65   vColor = aVerte
00001f30: 78 43 6f 6c 6f 72 3b 0a 20 20 7d 0a 3c 2f 73 63  xColor;.  }.</sc
00001f40: 72 69 70 74 3e 0a 20 20 3c 2f 68 65 61 64 3e 0a  ript>.  </head>.
00001f50: 20 20 3c 62 6f 64 79 20 6f 6e 6c 6f 61 64 3d 22    <body onload="
00001f60: 77 65 62 47 4c 53 74 61 72 74 28 29 22 3e 0a 20  webGLStart()">. 
00001f70: 20 20 20 47 79 72 6f 20 61 6e 64 20 61 63 63 65     Gyro and acce
00001f80: 6c 65 72 61 74 69 6f 6e 0a 20 20 20 20 3c 63 61  leration.    <ca
00001f90: 6e 76 61 73 20 69 64 3d 22 67 79 72 6f 2d 63 61  nvas id="gyro-ca
00001fa0: 6e 76 61 73 22 20 73 74 79 6c 65 3d 22 62 6f 72  nvas" style="bor
00001fb0: 64 65 72 3a 20 6e 6f 6e 65 3b 22 20 77 69 64 74  der: none;" widt
00001fc0: 68 3d 22 35 30 30 22 20 68 65 69 67 68 74 3d 22  h="500" height="
00001fd0: 35 30 30 22 3e 3c 2f 63 61 6e 76 61 73 3e 0a 3c  500"></canvas>.<
00001fe0: 69 6e 70 75 74 20 74 79 70 65 3d 22 62 75 74 74  input type="butt
00001ff0: 6f 6e 22 20 6e 61 6d 65 3d 22 53 74 61 72 74 22  on" name="Start"
00002000: 20 76 61 6c 75 65 3d 22 53 74 61 72 74 22 0a 6f   value="Start".o
00002010: 6e 63 6c 69 63 6b 3d 22 77 69 6e 64 6f 77 2e 73  nclick="window.s
00002020: 65 74 49 6e 74 65 72 76 61 6c 28 27 72 65 66 72  etInterval('refr
00002030: 65 73 68 44 61 74 61 28 29 3b 20 64 72 61 77 53  eshData(); drawS
00002040: 63 65 6e 65 28 29 3b 27 2c 20 31 30 30 29 22 2f  cene();', 100)"/
00002050: 3e 0a 20 20 3c 2f 62 6f 64 79 3e 0a 3c 2f 68 74  >.  </body>.</ht
00002060: 6d 6c 3e 0a                                      ml>.
